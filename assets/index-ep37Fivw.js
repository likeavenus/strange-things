var t=Object.defineProperty,i=(i,e,s)=>((i,e,s)=>e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s)(i,"symbol"!=typeof e?e+"":e,s);import{P as e,p as s}from"./phaser-Dp_CM4nq.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var a=(t=>(t[t.Disabled=0]="Disabled",t[t.Ground=1]="Ground",t[t.Player=2]="Player",t[t.Projectile=4]="Projectile",t[t.EnergySphere=8]="EnergySphere",t[t.Enemy=16]="Enemy",t[t.Platforms=32]="Platforms",t[t.Torch=64]="Torch",t[t.EnemySphere=128]="EnemySphere",t[t.DeathCollider=256]="DeathCollider",t[t.Mimic=512]="Mimic",t[t.Treasure=1024]="Treasure",t[t.MimicAttack=2048]="MimicAttack",t[t.Portal=4096]="Portal",t))(a||{});class r extends e.Physics.Matter.Sprite{constructor(t,e,s,r,o){super(t.matter.world,e,s,r),i(this,"direction"),i(this,"speed",0),i(this,"scene"),this.scene=t,this.direction=o,this.setCircle(this.width/4),this.setIgnoreGravity(!0),this.setFixedRotation(),this.setTint(61695),this.setCollisionCategory(a.EnergySphere),this.setCollidesWith([a.Enemy,a.Ground,a.Mimic]),t.add.existing(this),this.launch(),this.scene.matter.world.on("collisionstart",this.handleCollision,this)}launch(){const t=this.scene.lights.addLight(this.x,this.y,256,void 0,5);t.color.set(0,.5,1);const i=this.scene.lights;this.scene.tweens.add({targets:this,speed:40,duration:40/70*1e3,onUpdate:(i,e)=>{if(e&&e.active){const i=e.speed*e.direction;e.setVelocityX(i),t.setPosition(e.x,e.y)}},onComplete:()=>{i.removeLight(t)}})}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.EnergySphere&&e.collisionFilter.category===a.Ground||e.collisionFilter.category===a.EnergySphere&&i.collisionFilter.category===a.Ground||i.collisionFilter.category===a.EnergySphere&&e.collisionFilter.category===a.Enemy||i.collisionFilter.category===a.Enemy&&e.collisionFilter.category===a.EnergySphere||i.collisionFilter.category===a.EnergySphere&&e.collisionFilter.category===a.Mimic||i.collisionFilter.category===a.Mimic&&e.collisionFilter.category===a.EnergySphere)&&this.destroy(!0)}))}update(){}}class o extends e.Physics.Matter.Sprite{constructor(t,e,s,r,o){var n;super(t.matter.world,e,s,r,o,{label:"wizard",frictionAir:.05}),i(this,"isTouchingGround",!1),i(this,"isAttacking",!1),i(this,"isFalling",!1),i(this,"isStunned",!1),i(this,"isCutscene",!1),i(this,"isTeleported",!1),i(this,"jumpMaxCounter",2),i(this,"currentJumpCounter",0),i(this,"hp",5),i(this,"maxHP",10),i(this,"mana",2),i(this,"maxMana",5),i(this,"graphics"),i(this,"amuletOfLight"),i(this,"lightSphere"),i(this,"knockbackVelocity",15),i(this,"knockbackDuration",300),i(this,"knockbackTimer",0),i(this,"footstepTimer"),i(this,"footstepInterval",300),this.setName("wizard"),this.flipX=!1,(n=t.anims).create({key:"wizard_idle",frames:n.generateFrameNames("wizard_idle",{start:0,end:5,prefix:"Idle",suffix:".png"}),repeat:-1,frameRate:10}),n.create({key:"wizard_run",frames:n.generateFrameNames("wizard_run",{start:0,end:7,prefix:"Run",suffix:".png"}),repeat:-1,frameRate:14}),n.create({key:"wizard_jump",frames:n.generateFrameNames("wizard_jump",{start:0,end:1,prefix:"Jump",suffix:".png"}),repeat:-1,frameRate:10}),n.create({key:"wizard_fall",frames:n.generateFrameNames("wizard_fall",{start:0,end:1,prefix:"Fall",suffix:".png"}),repeat:-1,frameRate:10}),n.create({key:"wizard_attack1",frames:n.generateFrameNames("wizard_attack1",{start:10,end:17,prefix:"Attack",suffix:".png"}),frameRate:15}),n.create({key:"wizard_attack2",frames:n.generateFrameNames("wizard_attack2",{start:20,end:27,prefix:"Attack",suffix:".png"}),frameRate:15}),n.create({key:"wizard_death",frames:n.generateFrameNames("wizard_death",{start:0,end:6,prefix:"Death",suffix:".png"}),frameRate:11}),n.create({key:"wizard_hit",frames:n.generateFrameNames("wizard_hit",{start:0,end:3,prefix:"Hit",suffix:".png"}),frameRate:11}),this.anims.play("wizard_idle"),this.setScale(2),this.setFixedRotation(),t.input.keyboard.on("keydown-E",this.baseAttack,this),t.input.keyboard.on("keydown-F",this.rangeAttack,this),this.setCollisionCategory(a.Player),this.setCollidesWith([a.Ground,a.Enemy,a.EnemySphere,a.MimicAttack,a.Portal]),t.add.existing(this),this.setPipeline("Light2D"),t.matter.world.on("collisionstart",this.handleCollision,this),t.matter.world.on("collisionstart",this.handleCollisionStart,this),t.matter.world.on("collisionend",this.handleCollisionEnd,this),this.graphics=t.add.graphics(),this.graphics.setDepth(100),t.time.addEvent({loop:!0,delay:1e3,callback:()=>{this.mana<6&&(this.mana+=.5)}}),this.createMagicLight()}baseAttack(){this.isAttacking||!this.isTouchingGround||this.hp<=0||(this.setVelocity(0),this.isAttacking=!0,this.setOrigin(.5,.7),this.anims.play("wizard_attack1"),this.once("animationcomplete",(t=>{"wizard_attack1"===t.key&&(this.isAttacking=!1,this.setOrigin(.5,.5),this.anims.play("wizard_idle",!0))})))}increaseFallSpeed(){this.setVelocityY(this.body.velocity.y+.5)}rangeAttack(){!this.isAttacking&&this.isTouchingGround&&(this.hp<=0||0===this.mana||(this.isAttacking=!0,this.scene.sound.setDetune(-1e3),this.scene.sound.play("energy-attack"),this.mana-=1,this.setOrigin(.4,.6),this.setVelocity(0),this.anims.play("wizard_attack2",!0),this.once("animationcomplete",(t=>{"wizard_attack2"===t.key&&(this.isAttacking=!1,this.setOrigin(.5,.5),this.anims.play("wizard_idle",!0))})),this.createEnergySphere()))}createEnergySphere(){const t=this.flipX?-1:1,i=new r(this.scene,t>0?this.x+60:this.x-60,this.y-this.height/2+15,"red",t);this.scene.projectiles.add(i)}playFootstep(){var t;0!==(null==(t=this.body)?void 0:t.velocity)&&(this.footstepTimer=this.scene.time.addEvent({delay:this.footstepInterval,callback:this.playFootstep,callbackScope:this,loop:!1}))}preUpdate(t,i){super.preUpdate(t,i)}update(t,i){if(this.drawMana(),this.drawHP(),this.amuletOfLight&&this.updateMagicLight(i),this.isTeleported)return;if(this.hp<=0)return;if(this.isStunned)return;const{left:s,right:a,up:r,down:o,space:n}=t;this.body.velocity.y>.1?this.isFalling=!0:this.isFalling=!1,this.isFalling&&this.increaseFallSpeed(),this.isAttacking||(!this.isTouchingGround&&this.body.velocity.y<0?(this.anims.play("wizard_jump",!0),a.isDown?(this.setVelocityX(12),this.flipX=!1):s.isDown&&(this.setVelocityX(-12),this.flipX=!0)):!this.isTouchingGround&&this.body.velocity.y>0?(a.isDown?(this.setVelocityX(12),this.flipX=!1):s.isDown&&(this.setVelocityX(-12),this.flipX=!0),this.isFalling&&this.anims.play("wizard_fall",!0)):s.isDown?(this.setVelocityX(-12),this.flipX=!0,this.anims.play("wizard_run",!0)):a.isDown?(this.setVelocityX(12),this.flipX=!1,this.anims.play("wizard_run",!0)):(this.setVelocityX(0),this.anims.play("wizard_idle",!0)),e.Input.Keyboard.JustDown(n)&&(this.isTouchingGround||!this.isTouchingGround&&this.currentJumpCounter<this.jumpMaxCounter)&&(this.setVelocityY(-30),this.isTouchingGround=!1,this.currentJumpCounter++),this.currentJumpCounter===this.jumpMaxCounter&&this.isTouchingGround&&(this.currentJumpCounter=0))}createMagicLight(){this.amuletOfLight=this.scene.lights.addLight(this.x,this.y,256,16777215,2),this.lightSphere=this.scene.matter.add.image(this.x,this.y,"red",void 0,{isStatic:!0,isSensor:!0,collisionFilter:{category:a.Disabled}})}updateMagicLight(t){this.amuletOfLight&&(this.amuletOfLight.setPosition(this.lightSphere.x,this.lightSphere.y),this.lightSphere.setPosition(this.x+(this.flipX?-70:70),this.y-70))}slowDownTime(){this.scene.matter.world.engine.timing.timeScale=.1,this.scene.time.delayedCall(300,(()=>{this.scene.matter.world.engine.timing.timeScale=1}))}flashEffect(){const t=Math.floor(10);this.scene.add.timeline({});for(let i=0;i<t;i++)this.setTint(i%2==0?0:16777215)}getDamage(){this.isAttacking=!1,this.hp-=1,this.scene.sound.play("skull-crash"),this.applyKnockback(this.flipX?"left":"right"),this.isStunned=!0,this.on("animationcomplete",(t=>{"wizard_hit"===t.key&&(this.isStunned=!1)})),this.hp<=0?(this.anims.play("wizard_death",!0),this.setCollisionCategory(a.DeathCollider)):(this.anims.play("wizard_hit"),this.scene.children.each((t=>{(null==t?void 0:t.anims)&&(t.anims.timeScale=.4)})),this.scene.time.delayedCall(300,(()=>{this.scene.children.each((t=>{(null==t?void 0:t.anims)&&(t.anims.timeScale=1)}))})))}applyKnockback(t){if(this.isStunned)return;const i="left"===t?this.knockbackVelocity:-this.knockbackVelocity;this.knockbackVelocity,this.setVelocityX(i),this.knockbackTimer=this.knockbackDuration}handleCollisionStart(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.Ground&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.Ground&&i.collisionFilter.category===a.Player)&&(this.isTouchingGround||(this.isTouchingGround=!0,this.currentJumpCounter=0))}))}handleCollisionEnd(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.Ground&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.Ground&&i.collisionFilter.category===a.Player)&&(this.isTouchingGround=!1)}))}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.EnemySphere&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.EnemySphere&&i.collisionFilter.category===a.Player||i.collisionFilter.category===a.MimicAttack&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.MimicAttack&&i.collisionFilter.category===a.Player)&&(this.scene.cameras.main.shake(500,.009),this.slowDownTime(),this.getDamage())}))}drawMana(){this.graphics.clear(),this.graphics.setScrollFactor(0),this.graphics.setPosition(50,50);const t=10;for(let i=0;i<this.mana;i++){const e=10+30*i,s=50;this.graphics.beginPath(),this.graphics.moveTo(e,s-t),this.graphics.lineTo(e+t,s),this.graphics.lineTo(e,s+t),this.graphics.lineTo(e-t,s),this.graphics.closePath(),this.graphics.fillPath(),i<this.mana&&(this.graphics.fillStyle(1118719),this.graphics.beginPath(),this.graphics.moveTo(e,s-t),this.graphics.lineTo(e+t,s),this.graphics.lineTo(e,s+t),this.graphics.lineTo(e-t,s),this.graphics.closePath(),this.graphics.fillPath())}}drawHP(){this.graphics.setScrollFactor(0),this.graphics.setPosition(10,30);for(let t=0;t<this.maxHP;t++){const i=10+25*t*1.3,e=10;this.graphics.fillStyle(16777215),this.graphics.fillCircle(i,e,13),t<this.hp&&(this.graphics.fillStyle(16711680),this.graphics.fillCircle(i,e,12))}}}class n extends r{constructor(t,e,s,r,o){super(t,e,s,r,o),i(this,"direction",-1),this.direction=o,this.setTint(4915330),this.setCollisionCategory(a.EnemySphere),this.setCollidesWith([a.Player,a.Ground])}launch(){const t=this.scene.lights.addLight(this.x,this.y,256,void 0,5);t.color.set(.5,.1,0);const i=this.scene.lights;this.scene.tweens.add({targets:this,speed:40,duration:40/70*1e3,onUpdate:(i,e)=>{if(e&&e.active){const i=e.speed*e.direction;e.setVelocityX(i),t.setPosition(e.x,e.y)}},onComplete:()=>{i.removeLight(t)}})}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.EnemySphere&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.EnemySphere&&i.collisionFilter.category===a.Player||i.collisionFilter.category===a.EnemySphere&&e.collisionFilter.category===a.Ground||e.collisionFilter.category===a.EnemySphere&&i.collisionFilter.category===a.Ground)&&this.destroy(!0)}))}}class h extends e.Physics.Matter.Sprite{constructor(t,s,r,o,n){var h;super(t.matter.world,s,r,o,n,{label:"heretic",frictionAir:.05}),i(this,"isTouchingGround",!1),i(this,"isAttacking",!1),i(this,"isFalling",!1),i(this,"jumpMaxCounter",2),i(this,"currentJumpCounter",0),i(this,"direction",1),i(this,"isDead",!1),this.flipX=!1,(h=t.anims).create({key:"heretic_run",frames:h.generateFrameNames("heretic_run",{start:0,end:7,prefix:"Run",suffix:".png"}),repeat:-1,frameRate:10}),h.create({key:"heretic_attack2",frames:h.generateFrameNames("heretic_attack2",{start:20,end:27,prefix:"Attack",suffix:".png"}),frameRate:15}),this.anims.play("heretic_run"),this.setScale(3),this.setRectangle(2*this.width,3*this.height,{}),this.setFixedRotation(),this.setOnCollide((t=>{this.isTouchingGround=!0})),this.setCollisionCategory(a.Enemy),this.setCollidesWith([a.Ground,a.Player,a.EnergySphere]),t.add.existing(this),this.scene.matter.world.on("collisionstart",this.handleCollision,this),this.scene.time.addEvent({loop:!0,delay:1600,callback:()=>{this.isDead||(this.direction=-this.direction)}}),this.scene.time.addEvent({loop:!0,delay:2e3,callback:()=>{if(!this.isDead){const t=this.scene.children.getByName("wizard");e.Math.Distance.Between(t.x,t.y,this.x,this.y)<700&&this.rangeAttack()}}})}baseAttack(){!this.isAttacking&&this.isTouchingGround&&(this.setVelocity(0),this.isAttacking=!0,this.setOrigin(.5,.7),this.anims.play("wizard_attack1"),this.once("animationcomplete",(t=>{"wizard_attack1"===t.key&&(this.isAttacking=!1,this.setOrigin(.5,.5),this.anims.play("wizard_idle",!0))})))}increaseFallSpeed(){this.setVelocityY(this.body.velocity.y+.5)}rangeAttack(){!this.isAttacking&&this.isTouchingGround&&(this.isAttacking=!0,this.setOrigin(.4,.68),this.setVelocity(0),this.anims.play("heretic_attack2",!0),this.once("animationcomplete",(t=>{"heretic_attack2"===t.key&&(this.isAttacking=!1,this.setOrigin(.5,.5),this.anims.play("heretic_run",!0))})),this.createEnergySphere())}createEnergySphere(){const t=this.flipX?-1:1,i=new n(this.scene,t>0?this.x+30:this.x-30,this.y-this.height/2+15,"red",t);this.scene.projectiles.add(i)}update(t){this.isAttacking||this.isDead||this&&(this.direction>0?(this.flipX=!1,this.setVelocityX(10)):(this.flipX=!0,this.setVelocityX(-10)))}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.EnergySphere&&e.collisionFilter.category===a.Enemy||e.collisionFilter.category===a.EnergySphere&&i.collisionFilter.category===a.Enemy)&&(this.isDead=!0,this.destroy(!0))}))}}class l extends e.Physics.Matter.Sprite{constructor(t,e,s,r,o){var n;super(t.matter.world,e,s,r,o,{label:"mimic",frictionAir:.05}),i(this,"isTouchingGround",!1),i(this,"isOpen",!1),i(this,"isAttacking",!1),this.setName("mimic"),this.flipX=!0,(n=t.anims).create({key:"mimic_hidden",frames:[{key:"mimic_hidden",frame:"Mimic_Idle_Hidden0.png",duration:1500},{key:"mimic_hidden",frame:"Mimic_Idle_Hidden1.png",duration:200},{key:"mimic_hidden",frame:"Mimic_Idle_Hidden2.png",duration:1500},{key:"mimic_hidden",frame:"Mimic_Idle_Hidden3.png",duration:200}],repeat:-1,frameRate:10,duration:3e3}),n.create({key:"mimic_open",frames:n.generateFrameNames("mimic_open",{start:0,end:3,prefix:"Chest",suffix:".png"}),frameRate:10,duration:1e3}),n.create({key:"mimic_attack1",frames:n.generateFrameNames("mimic_attack1",{start:10,end:13,prefix:"Mimic_Attack-",suffix:".png"}),frameRate:9,duration:1e3}),this.anims.play("mimic_hidden"),this.anims.pause(),this.setScale(4),this.setDepth(99),this.setFixedRotation(),this.setCollisionCategory(a.Mimic),this.setCollidesWith([a.Ground,a.Enemy,a.EnemySphere,a.EnergySphere]),t.add.existing(this),this.setPipeline("Light2D"),t.matter.world.on("collisionstart",this.handleCollision,this)}baseAttack(){if(this.isAttacking||this.isOpen)return;let t;this.isAttacking=!0,this.setOrigin(.5,.59),this.anims.play("mimic_attack1"),this.scene.time.delayedCall(250,(()=>{this.scene.sound.setDetune(2e3*Math.random()),this.scene.sound.stopByKey("mimic-attack1"),this.scene.sound.play("mimic-attack1"),t=this.scene.matter.add.rectangle(this.x-50,this.y,100,100,{isSensor:!0,isStatic:!0,collisionFilter:{category:a.MimicAttack,mask:a.Player}})})),this.once("animationcomplete",(i=>{"mimic_attack1"===i.key&&(t&&this.scene.matter.world.remove(t),this.isAttacking=!1,this.setOrigin(.5,.5),this.anims.play("mimic_hidden",!0))}))}update(t){if(this.isAttacking||this.isOpen)return;const i=this.scene.children.getByName("wizard");e.Math.Distance.Between(i.x,i.y,this.x,this.y)<500?this.anims.play("mimic_hidden",!0):(this.anims.play("mimic_hidden",!0),this.anims.pause()),e.Math.Distance.Between(i.x,i.y,this.x,this.y)<200&&i.hp>0&&this.baseAttack()}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;(i.collisionFilter.category===a.EnergySphere&&e.collisionFilter.category===a.Mimic||e.collisionFilter.category===a.EnergySphere&&i.collisionFilter.category===a.Mimic)&&(this.isOpen||(this.anims.play("mimic_open",!0),this.isOpen=!0))}))}}class c extends e.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,name:"CRTShader",fragShader:"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform sampler2D uMainSampler;\nuniform float time;\nuniform vec2 resolution;\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n    // Цветовые каналы с небольшими искажениями\n    float r = texture2D(uMainSampler, uv + sin(uv.y * 10.0 + time * 5.0) * 0.001).r;\n    float g = texture2D(uMainSampler, uv + sin(uv.y * 10.0 + time * 5.0 + 2.0) * 0.001).g;\n    float b = texture2D(uMainSampler, uv + sin(uv.y * 10.0 + time * 5.0 + 4.0) * 0.001).b;\n\n    // Добавляем сканирующие линии\n    float scanline = sin(uv.y * resolution.y * 3.1415) * 0.02;\n    vec3 color = vec3(r, g, b) - scanline;\n\n    gl_FragColor = vec4(color, 1.0);\n}\n"})}onPreRender(){this.set1f("time",this.game.loop.time/2e3),this.set2f("resolution",this.renderer.width,this.renderer.height)}}class d extends s.Scene{constructor(){super("Game"),i(this,"camera"),i(this,"wizard"),i(this,"cursors"),i(this,"projectiles"),i(this,"light"),i(this,"heretic"),i(this,"hereticGroup"),i(this,"isCutscene",!1),i(this,"mimic"),i(this,"currentMusic"),i(this,"randomSound"),i(this,"topBlackBars"),i(this,"bottomBlackBars")}preload(){this.cursors=this.input.keyboard.createCursorKeys()}initMusic(){this.currentMusic=this.sound.add("mysterious-dungeons-ambiance",{volume:.5}),this.randomSound=this.sound.add("creepy-demon-heavy-breathing",{volume:.7}),this.time.addEvent({loop:!0,delay:2e4,callback:()=>{this.randomSound.play()}}),this.currentMusic.play()}createPlatform(t,i,e){const s=this.matter.add.image(t,i,"platform",void 0,{isStatic:!0,label:"platform"});s.setPipeline("Light2D"),e?this.tweens.add({targets:s,y:s.y-1e3,yoyo:!0,duration:4e3,repeat:-1,ease:"ease"}):this.tweens.add({targets:s,y:s.x-1e3,yoyo:!0,duration:4e3,repeat:-1,ease:"ease"})}createMap(){const t=this.make.tilemap({key:"map",tileHeight:64,tileWidth:64}),i=t.addTilesetImage("brick","tileset",64,64);[t.createLayer("ground",i,0,0),t.createLayer("platforms",i,0,0),t.createLayer("handle1",i,0,0)].forEach((t=>{const i=null==t?void 0:t.layer.name;null==t||t.setName(i),null==t||t.setCollisionByProperty({collides:!0}),"ground"===i&&(null==t||t.setCollisionCategory(a.Ground)),"platforms"===i&&(null==t||t.setCollisionCategory(a.Platforms)),null==t||t.setCollidesWith([a.Player,a.Projectile,a.Enemy]),null==t||t.setPipeline("Light2D"),this.matter.world.convertTilemapLayer(t)}))}createTorch(t,i){this.anims.create({key:"torch1",frames:this.anims.generateFrameNames("torch1",{start:10,end:12,prefix:"bigtorchlit",suffix:".png"}),repeat:-1,frameRate:9});const e=this.matter.add.sprite(t,i,"torch1",void 0,{isStatic:!0});e.setScale(1.5),e.setPipeline("Light2D"),e.anims.play("torch1"),this.lights.addLight(e.x,e.y-100,512,void 0,2),e.setCollisionCategory(a.Torch)}create(){this.camera=this.cameras.main,this.camera.setZoom(.9),this.camera.fadeIn(1e3),this.camera.setPostPipeline(new c(this.game)),this.lights.enable(),this.projectiles=this.add.group(),this.createPlatform(1290,2800,!0),this.createTorch(150,2975),this.createTorch(1050,2975),this.createTorch(2350,3100),this.createTorch(1e3,1060),this.createTorch(3700,2850),this.wizard=new o(this,90,2975,"wizard_idle"),this.createMap(),this.camera.setDeadzone(250,250),this.camera.startFollow(this.wizard,!0,1,1,-100,-30),this.light=this.lights.addLight(this.wizard.x,this.wizard.y,512,void 0,1),this.hereticGroup=this.add.group({classType:h,key:"heretic",runChildUpdate:!0}),this.hereticGroup.get(1200,2900),this.mimic=new l(this,3600,2900,"mimic_hidden")}createBlackBars(){const t=this.cameras.main.width;this.topBlackBars=this.add.rectangle(t/2,-50,t,100,0).setOrigin(.5,0).setDepth(1e3),this.bottomBlackBars=this.add.rectangle(t/2,this.cameras.main.height+50,t,100,0).setOrigin(.5,1).setDepth(1e3),this.tweens.add({targets:this.topBlackBars,y:0,duration:1e3,ease:"Power2"}),this.tweens.add({targets:this.bottomBlackBars,y:this.cameras.main.height,duration:1e3,ease:"Power2"})}update(t,i){this.wizard.update(this.cursors,t),this.mimic.update(this.cursors),this.projectiles.children.each((function(t){t.update()}),this)}}class m extends s.Scene{constructor(){super("Preloader")}init(){}loadHeretic(){this.load.atlas("heretic_run","heretic/run/Run.png","heretic/run/Run.json"),this.load.atlas("heretic_attack2","heretic/attack2/Attack2.png","heretic/attack2/Attack2.json")}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.atlas("wizard_idle","wizard/idle/idle.png","wizard/idle/idle.json"),this.load.atlas("wizard_run","wizard/run/Run.png","wizard/run/Run.json"),this.load.atlas("wizard_jump","wizard/jump/Jump.png","wizard/jump/Jump.json"),this.load.atlas("wizard_fall","wizard/fall/Fall.png","wizard/fall/Fall.json"),this.load.atlas("wizard_attack1","wizard/attack1/Attack1.png","wizard/attack1/Attack1.json"),this.load.atlas("wizard_attack2","wizard/attack2/Attack2.png","wizard/attack2/Attack2.json"),this.load.atlas("wizard_death","wizard/death/Death.png","wizard/death/Death.json"),this.load.atlas("wizard_hit","wizard/hit/Hit.png","wizard/hit/Hit.json"),this.load.image("tileset","map/brick.png"),this.load.tilemapTiledJSON("map","map/map.json"),this.load.image("home-tileset","map/home.png"),this.load.tilemapTiledJSON("home","map/home.json"),this.load.image("home-bg-1","map/home/home-bg-1.png"),this.load.atlas("portal","environment/portal/portal.png","environment/portal/portal.json"),this.load.image("platform","map/platform.png"),this.load.image("red","wizard/magic/red.png"),this.load.atlas("torch1","torch/torch.png","torch/torch.json"),this.loadHeretic(),this.load.audio("footstep","wizard/footstep.mp3"),this.load.audio("creepy-demon-heavy-breathing","environment/sounds/creepy-demon-heavy-breathing.wav"),this.load.audio("mysterious-dungeons-ambiance","environment/sounds/mysterious-dungeons-ambiance.mp3"),this.load.audio("dungeon","environment/sounds/dungeon_.mp3"),this.load.audio("skull-crash","wizard/skull-crash.mp3"),this.load.audio("mimic-attack1","mimic/mimic-attack1.mp3"),this.load.audio("energy-attack","wizard/energy-attack.mp3"),this.load.atlas("mimic_hidden","mimic/Mimic_Idle_Hidden.png","mimic/Mimic_Idle_Hidden.json"),this.load.atlas("mimic_open","mimic/Mimic_Open.png","mimic/Mimic_Open.json"),this.load.atlas("mimic_attack1","mimic/Mimic_Attack-1.png","mimic/Mimic_Attack-1.json")}create(){this.scene.start("Home")}}class p extends e.Physics.Matter.Sprite{constructor(t,i,e,s,r){var o;super(t.matter.world,i,e,s,r,{label:"portal",isSensor:!0,isStatic:!0}),this.setName("portal"),(o=t.anims).create({key:"portal-animate",frames:o.generateFrameNames("portal",{start:0,end:104,prefix:"convert",suffix:".png"}),repeat:-1,frameRate:14}),this.anims.play("portal-animate"),this.setDepth(99),this.setFixedRotation(),this.setCollisionCategory(a.Portal),this.setCollidesWith([a.Player]),t.add.existing(this),t.matter.world.on("collisionstart",this.handleCollision,this)}update(t){}handleCollision(t){t.pairs.forEach((t=>{const{bodyA:i,bodyB:e}=t;if(i.collisionFilter.category===a.Portal&&e.collisionFilter.category===a.Player||e.collisionFilter.category===a.Player&&i.collisionFilter.category===a.Portal){const t=this.scene.children.getByName("wizard");t.isTeleported=!0,t.anims.play("wizard_idle"),this.scene.cameras.main.fadeOut(800,0,0,0),this.scene.time.delayedCall(1050,(()=>{this.scene.scene.start("Game")}))}}))}}class g extends e.Scene{constructor(){super("Home"),i(this,"wizard"),i(this,"portal"),i(this,"camera"),i(this,"cursors")}preload(){this.cursors=this.input.keyboard.createCursorKeys()}addBackground(){this.add.image(1240,1e3,"home-bg-1").setScale(5,4)}createTorch(t,i){this.anims.create({key:"torch1",frames:this.anims.generateFrameNames("torch1",{start:10,end:12,prefix:"bigtorchlit",suffix:".png"}),repeat:-1,frameRate:9});const e=this.matter.add.sprite(t,i,"torch1",void 0,{isStatic:!0});e.setScale(1),e.setPipeline("Light2D"),e.anims.play("torch1"),this.lights.addLight(e.x,e.y-50,512,void 0,2),e.setCollisionCategory(a.Torch)}create(){this.projectiles=this.add.group(),this.portal=new p(this,2450,700,"portal"),this.addBackground(),this.camera=this.cameras.main,this.createMap(),this.wizard=new o(this,90,1e3,"wizard_idle"),this.camera.setDeadzone(250,250),this.camera.startFollow(this.wizard,!0,1,1,-100,-30),this.lights.enable(),this.createTorch(120,1300),this.createTorch(650,1300),this.createTorch(1300,1300),this.createTorch(2e3,1300)}createMap(){const t=this.make.tilemap({key:"home",tileHeight:64,tileWidth:64}),i=t.addTilesetImage("home","home-tileset",64,64);[t.createLayer("ground",i,0,0)].forEach((t=>{const i=null==t?void 0:t.layer.name;null==t||t.setName(i),null==t||t.setCollisionByProperty({collides:!0}),"Слой тайлов 1"===i&&(null==t||t.setCollisionCategory(a.Ground)),"platforms"===i&&(null==t||t.setCollisionCategory(a.Platforms)),null==t||t.setCollidesWith([a.Player,a.Projectile,a.Enemy]),null==t||t.setPipeline("Light2D"),this.matter.world.convertTilemapLayer(t)}))}update(t,i){this.wizard.update(this.cursors,t)}}const y={type:Phaser.WEBGL,width:innerWidth,parent:"game-container",scale:{},physics:{default:"matter",matter:{gravity:{y:2}}},pipeline:{CRTShader:c},scene:[m,g,d]};new s.Game(y);
